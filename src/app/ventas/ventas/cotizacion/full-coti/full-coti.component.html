<section *ngIf="venta$|async" class="mainPost">
  <div class="info">
    <h1><span>#{{(venta$|async).codigo}}</span></h1>
    <h5>Realizada: {{(venta$|async).date | date}} {{date}}</h5>
  </div>
  <div>
    <button (click)="openAddItemDialog()" [ngStyle]="{'margin-right': '.5em', 'width': '160px'}" mat-flat-button color="accent">Agregar Item</button>
    <button (click)="openClonar()" [ngStyle]="{'margin-right': '.5em', 'width': '160px'}" mat-stroked-button color="primary">Clonar Cotización</button>
    <button (dblclick)="eliminarCoti()" [ngStyle]="{'margin-right': '.5em', 'width': '160px'}" mat-stroked-button color="accent">Eliminar Cotización</button>
  </div>
  <mat-tab-group color="accent" dynamicHeight>
    <mat-tab  label="Conteo Simple">
      <div>
        <table mat-table [dataSource]="(dataSource$|async)" >
          <!-- Position Column -->
          <ng-container matColumnDef="codigo">
            <th  mat-header-cell *matHeaderCellDef> Cod. </th>
            <td  mat-cell *matCellDef="let element"> {{element.codigo}} </td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th class="cuarenta" mat-header-cell *matHeaderCellDef> Nombre </th>
            <td class="cuarenta" mat-cell *matCellDef="let element"> {{element.name}} </td>
          </ng-container>

          <!-- Weight Column -->
          <ng-container matColumnDef="cantidad">
            <th class="atTheEND" mat-header-cell *matHeaderCellDef> Cantidad </th>
            <td class="atTheEND" mat-cell *matCellDef="let element"> {{element.cantidad}} </td>
          </ng-container>

          <!-- Symbol Column -->
          <ng-container matColumnDef="priceIGV">
            <th class="atTheEND"  mat-header-cell *matHeaderCellDef> Precio/UD </th>
            <td class="atTheEND"  mat-cell *matCellDef="let element"> {{element.priceIGV|currency:'S/ '}} </td>
          </ng-container>

          <ng-container matColumnDef="totalPrice">
            <th class="atTheEND" mat-header-cell *matHeaderCellDef> Precio Total </th>
            <td class="atTheEND" mat-cell *matCellDef="let element"> {{element.totalPrice|currency:'S/ '}} </td>
          </ng-container>

          <ng-container matColumnDef="editar">
            <th class="atTheEND tableBtn" mat-header-cell *matHeaderCellDef> Editar </th>
            <td class="atTheEND tableBtn" mat-cell *matCellDef="let element">
              <button (click)="openEditarItemDialog(element)"  mat-stroked-button  type="button" color="primary">Editar</button>
            </td>
          </ng-container>

          <ng-container matColumnDef="eliminar">
            <th class="atTheEND tableBtn" mat-header-cell *matHeaderCellDef> Eliminar </th>
            <td class="atTheEND tableBtn" mat-cell *matCellDef="let element">
              <button (dblclick)="eliminarItem(element)"  mat-stroked-button  type="button" color="accent">-</button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </mat-tab>
    <mat-tab label="Conteo Detallado">
      <div class="contenidoCardVentas">
        <table mat-table [dataSource]="(tableVentaInfo$|async)" class="mat-elevation-z8">
          <!-- Item Column -->
          <ng-container matColumnDef="codigo">
            <th mat-header-cell *matHeaderCellDef> Cod. </th>
            <td mat-cell *matCellDef="let tableVentaInfo"> {{tableVentaInfo.codigo}} </td>
          </ng-container>


          <ng-container matColumnDef="name">
            <th class="vientoPor" mat-header-cell *matHeaderCellDef> Nombre </th>
            <td class="vientoPor" mat-cell *matCellDef="let tableVentaInfo"> {{tableVentaInfo.name}} </td>
          </ng-container>

          <ng-container matColumnDef="subName">
            <th mat-header-cell *matHeaderCellDef> Sub I </th>
            <td mat-cell *matCellDef="let tableVentaInfo"> {{tableVentaInfo.cantidadSC ? tableVentaInfo.cantidadSC.name : '...'}} </td>
          </ng-container>


          <ng-container matColumnDef="subNameSecond">
            <th mat-header-cell *matHeaderCellDef> Sub II </th>
            <td mat-cell *matCellDef="let tableVentaInfo"> {{tableVentaInfo.cantidadSC && tableVentaInfo.cantidadSC.nameSecond ? tableVentaInfo.cantidadSC.nameSecond : '...'}} </td>
          </ng-container>

          <ng-container matColumnDef="cantidad">
            <th mat-header-cell *matHeaderCellDef> Cantidad </th>
            <td mat-cell *matCellDef="let tableVentaInfo">
              {{tableVentaInfo.cantidadSC ? tableVentaInfo.cantidadSC.cantidadVenta : tableVentaInfo.cantidad}} </td>
          </ng-container>

          <ng-container matColumnDef="priceIGV">
            <th mat-header-cell *matHeaderCellDef> Precio </th>
            <td mat-cell *matCellDef="let tableVentaInfo"> {{tableVentaInfo.priceIGV|currency: 'S/ '}} </td>
          </ng-container>

          <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef> P. Total </th>
            <td mat-cell *matCellDef="let tableVentaInfo">
              {{(tableVentaInfo.cantidadSC ?  tableVentaInfo.cantidadSC.cantidadVenta * tableVentaInfo.priceIGV : tableVentaInfo.totalPrice)|currency: 'S/ ' }} </td>
          </ng-container>


          <tr mat-header-row *matHeaderRowDef="displayedColumnsVenta"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsVenta;"></tr>
        </table>
      </div>
    </mat-tab>
  </mat-tab-group>

  <div class="final">
    <div class="btns">
      <h5>{{(venta$|async).documento.name}}-{{(venta$|async).documento.codigo}} </h5>
      <h5>Celular: {{(venta$|async).celular_cliente || 'No se brindo'}} | email: {{(venta$|async).cliente_email || 'No se brindo'}}</h5>
      <button (click)="descargarCotiExcel()" [ngStyle]="{'margin-right': '.5em', 'margin-top': '.5em','width': '160px'}"
      mat-flat-button color="primary">Generar Excel</button>
      <button (click)="descargarCotiPDF()" [ngStyle]="{'margin-right': '.5em', 'margin-top': '.5em','width': '160px'}"
      mat-flat-button color="primary">Generar PDF</button>
    </div>

    <div class="totales">
      <h4>Total Base: {{((venta$|async).totalPriceNoIGV)|currency:'S/ '}}</h4>
      <h4>IGV 18%: {{((venta$|async).totalPrice - (venta$|async).totalPriceNoIGV)|currency:'S/ '}}</h4>
      <h3>Total: {{((venta$|async).totalPrice)|currency:'S/ '}}</h3>
    </div>
  </div>
</section>


