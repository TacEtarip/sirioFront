<img src="assets/close.svg" mat-dialog-title matDialogClose class="close-btn">
<h1 mat-dialog-title>Venta De: <b>{{item.name}}</b></h1>
<form [formGroup]="ventaForm">
    <div mat-dialog-content class="gridContainer" >
      <mat-form-field appearance="fill" class="example-full-width agregarVenta">
        <mat-label>Agregar A Venta</mat-label>
      <mat-select name="codigo" id="codigo" formControlName="selectAcction">
        <mat-option value="noAgregar">No Agregar</mat-option>
        <mat-option *ngFor="let venta of ventasActivas" [value]="venta.codigo">{{venta.codigo}}</mat-option>
      </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill"  class="example-full-width doubleGrid">
        <mat-label>Precio No IGV</mat-label>
        <input name="priceIGV" id="priceNoIGV" formControlName="priceNoIGV" type="number" min="0" step="1" matInput>
        <span matPrefix>S/ </span>
      </mat-form-field>
      <mat-form-field appearance="fill"  class="example-full-width doubleGridTwo">
        <mat-label>Precio</mat-label>
        <input (input)="changeNumber()" (focusout)="changeNumberOut()" name="priceIGV" id="priceIGV" formControlName="priceIGV" type="number" min="0" step="1" matInput>
        <span matPrefix>S/ </span>
      </mat-form-field>

      <mat-form-field *ngIf="!this.item.subConteo" appearance="fill"  class="example-full-width doubleGrid">
        <mat-label>Cantidad Disponible</mat-label>
        <input name="cantidad" id="cantidadD" formControlName="cantidadDisponible" type="number" min="1" step="1" matInput>
      </mat-form-field>
      <mat-form-field *ngIf="!this.item.subConteo" appearance="fill"  class="example-full-width doubleGridTwo">
        <mat-label>Cantidad</mat-label>
        <input (input)="actTotal()" (keypress)="resetSum()" name="cantidad" id="cantidad" formControlName="cantidadVenta" type="number" min="1" step="1" matInput>
        <mat-error>Cantidad Invalida</mat-error>
      </mat-form-field>



      <div *ngIf="this.item.subConteo" formArrayName="cantidadList" class="arrayForm">
        <div *ngFor="let sub of cantidadList.controls; index as i">
          <div [formGroupName]="i" class="secondGrid">
            <mat-form-field  appearance="fill" class="names tripleGrid">
              <mat-label>Sub...</mat-label>
              <input spellcheck="false" formControlName="name" maxlength="60" matInput>
            </mat-form-field>
            <mat-form-field  appearance="fill" class="names tripleGrid">
              <mat-label>Sub II...</mat-label>
              <input spellcheck="false" formControlName="nameSecond" maxlength="60" matInput>
            </mat-form-field>
            <mat-form-field  appearance="fill" class="cantidad tripleGrid">
              <mat-label>Cantidad Disponible</mat-label>
              <input   spellcheck="false" formControlName="cantidadDisponible" type="number" min="0" step="1" matInput>
            </mat-form-field>
            <mat-form-field  appearance="fill" class="cantidad tripleGrid">
              <mat-label>Cantidad</mat-label>
              <input (input)="actTotalForSubConteo(i)" (keypress)="resetSum()" spellcheck="false" formControlName="cantidadVenta" type="number" min="0" step="1" matInput>
              <mat-error>Cantidad Invalida</mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>
      <mat-form-field  appearance="fill" class="example-full-width doubleGrid singleGrid">
        <mat-label>Tipo De Comprobante</mat-label>
        <mat-select #SELECT [(value)]="currentDocumentType" (ngModelChange)="changeValidators()" name="documentoTipo"  formControlName="documentoTipo">
          <mat-option *ngFor="let item of tiposDocumentos" [value]="item.value">{{item.viewValue}}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field id="busquedaDOC" appearance="fill"  class="example-full-width doubleGridTwo singleGrid">
        <mat-label  *ngIf="ventaForm.get('documentoTipo').value === 'factura'">RUC</mat-label>
        <mat-label *ngIf="ventaForm.get('documentoTipo').value === 'boleta'">DNI</mat-label>
        <input (keyup)="comprobarDOC()"  name="docCod" id="docCod" formControlName="docCod" matInput>
      </mat-form-field>
      <mat-form-field appearance="fill"  class="example-full-width agregarVenta">
        <mat-label>Nombre...</mat-label>
        <input spellcheck="false" name="name" id="name" formControlName="nameDocumento" maxlength="60" matInput>
      </mat-form-field>
      <div class="hpc">
        <mat-checkbox (click)="changePrice()">Habilitar precio</mat-checkbox>
      </div>
      <h2 class="totalGrid">Total: S/ {{totalPriceIGV}}</h2>
    </div>
    <div mat-dialog-actions align="end">
      <button (click)="ventaSimple(ventaForm.getRawValue())" type="button" [disabled]="!ventaForm.valid || ventaForm.get('selectAcction').value !== 'noAgregar' || sum <= 0 || (!(documentAccepted|async) && (SELECT.value != 'noone'))" mat-flat-button color="primary">Vender</button>
      <button (click)="generarNuevaVenta(ventaForm.getRawValue())" type="button" [disabled]="!ventaForm.valid || ventaForm.get('selectAcction').value !== 'noAgregar' || sum <= 0 || (!(documentAccepted|async) && (SELECT.value != 'noone'))" mat-flat-button color="primary">Crear Venta</button>
      <button (click)="agregarItemVenta(ventaForm.getRawValue())" class="lastBTN" type="button" [disabled]="!ventaForm.valid || ventaForm.get('selectAcction').value === 'noAgregar' || sum <= 0" mat-flat-button color="primary">Agregar A Venta</button>
    </div>
</form>

<div  *ngIf="ventaEnCurso|async" id="overlay">
  <mat-spinner class="ventaR" color="accent"></mat-spinner>
</div>
